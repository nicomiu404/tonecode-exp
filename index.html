<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToneCode主観評価実験用音源</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 40px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            color: #444;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .track-box {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .track-box:last-child {
            border-bottom: none;
        }
        .track-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            display: block;
        }
        .file-info {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
            display: block;
        }
        audio {
            width: 100%;
            height: 40px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>可聴型データハイディングToneCodeに関する<br>主観評価実験</h1>

    <div id="login-screen">
        <p>管理者から配布されたユーザーID（数字）を入力して「実験を開始」を押してください。</p>
        <input type="number" id="user-id" placeholder="例: 101" />
        <button onclick="startExperiment()">実験を開始</button>
    </div>

    <div id="player-screen" class="hidden">
        <p style="text-align: center; margin-bottom: 30px;">
            以下の楽曲（A～H）を聴き、アンケートフォームの指示に従って回答してください。<br>
            <span style="font-size:0.9em; color:#666;">ID: <span id="display-id"></span></span>
        </p>
        <div id="playlist"></div>
    </div>

</div>

<script>
    // 拡張子
    const EXTENSION = ".wav"; 
    // 曲リスト
    const SONGS = ["A", "B", "C", "D", "E", "F", "G", "H", "I"];
    // バリエーション数
    const VARIATIONS = [1, 2, 3, 7, 9, 12, 13, 14, 15];


    function startExperiment() {
        const userIdInput = document.getElementById('user-id');
        const userId = parseInt(userIdInput.value);

        if (isNaN(userId)) {
            alert("有効なユーザーID（数字）を入力してください。");
            return;
        }

        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('player-screen').classList.remove('hidden');
        document.getElementById('display-id').textContent = userId;

        const rng = mulberry32(userId);

        shuffle(VARIATIONS, rng);

        const playlistDiv = document.getElementById('playlist');
        playlistDiv.innerHTML = "";

        SONGS.forEach((songName, index) => {
            const variantNum = VARIATIONS[index]; 
            const songChar = songName.toLowerCase();

            const fileName = `song_${songChar}_${variantNum}${EXTENSION}`;
            const filePath = `songs/${songChar}/${fileName}`;

            const html = `
                <div class="track-box">
                    <span class="track-title">楽曲 ${songName}</span>
                    <audio controls controlsList="nodownload">
                        <source src="${filePath}" type="audio/wav">
                        お使いのブラウザはオーディオ再生に対応していません。
                    </audio>
                </div>
            `;
            playlistDiv.insertAdjacentHTML('beforeend', html);
        });
    }

    // 乱数生成器 (Mulberry32)
    function mulberry32(a) {
        return function() {
            var t = a += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    // 配列シャッフル (Fisher-Yates)
    function shuffle(array, rng) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(rng() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
</script>

</body>
</html>